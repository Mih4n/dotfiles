monitor = ,preferred,auto,2

# exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = /usr/lib/polkit-kde-authentication-agent-1

# exec-once = ~/.config/hypr/scripts/wallpaperdaemon.sh
# exec-once = ~/.config/hypr/scripts/resetxdgportal.sh
# exec-once = ~/.config/hypr/scripts/batterynotify.sh
# exec-once = ~/.config/hypr/scripts/control.sh
# exec-once = ~/.config/hypr/scripts/eww.sh

exec-once = caelestia-shell

# Essential environment variables
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# NVIDIA Wayland configuration
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = WLR_NO_HARDWARE_CURSORS,1
env = LIBVA_DRIVER_NAME,nvidia

# Qt configuration
env = QT_QPA_PLATFORM,wayland
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = QT_AUTO_SCREEN_SCALE_FACTOR,1

# Firefox Wayland
env = MOZ_ENABLE_WAYLAND,1

# SD Notify
env = HYPRLAND_NO_SD_NOTIFY,0

# GPU selection - try different configurations:
# Option 1: Auto-detect (recommended first try)
# env = WLR_DRM_DEVICES,/dev/dri/card1:/dev/dri/card0

# Option 2: NVIDIA only
env = WLR_DRM_DEVICES,/dev/dri/card2 

# Option 3: If above doesn't work, try this:
# env = __NV_PRIME_RENDER_OFFLOAD,1
# env = __VK_LAYER_NV_optimus,NVIDIA_only
# env = __GLX_VENDOR_LIBRARY_NAME,nvidia

input {
    kb_layout = us,ru
    kb_options = grp:alt_shift_toggle
    
    repeat_rate = 50
    repeat_delay = 300

    follow_mouse = 1
    touchpad {
        natural_scroll = yes
    }

    sensitivity = -0.3 # -1.0 - 1.0, 0 means no modification.
    accel_profile = flat
}

gestures {
    workspace_swipe = true
    workspace_swipe_fingers = 3
}

plugin {
    touch_gestures {
        sensitivity = 1.0
        workspace_swipe_fingers = 3
        workspace_swipe_edge = d
        long_press_delay = 400
        resize_on_border_long_press = true
        edge_margin = 10
        emulate_touchpad_swipe = false
        experimental {
            send_cancel = 0
        }
    }
}

dwindle {
    pseudotile = no
    preserve_split = yes
}

master {
    new_status = master
}

misc {
    force_default_wallpaper = 0
    
    vfr = true
    vrr = 1
}

# Add this for NVIDIA compatibility
device {
    name = nvidia-gpu
    enabled = true
}

source = ~/.config/hypr/animations.conf
source = ~/.config/hypr/keybindings.conf
source = ~/.config/hypr/rules.conf
source = ~/.config/hypr/theme.conf